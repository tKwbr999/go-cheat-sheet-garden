---
title: "制御構文: 無限ループ `for {}` と `break`"
tags: ["flow-control", "for", "無限ループ", "ループ", "繰り返し", "break"]
---

Goの `for` 文は、条件式すらも省略することができます。条件式を省略すると、そのループは**無限ループ (Infinite Loop)** となり、明示的に中断されるまで永遠に処理を繰り返します。

## 無限ループの構文: `for { ... }`

`for` キーワードの後に条件式を書かずに `{}` ブロックを続けると、無限ループになります。

```go
for {
	// この中の処理が無限に繰り返される
}
```

## 無限ループからの脱出: `break` 文

無限ループは、そのままではプログラムが終了しなくなってしまうため、通常はループ内部のどこかで特定の条件が満たされた場合にループを中断する処理が必要です。そのために使われるのが **`break`** 文です。

`break` 文が実行されると、それが含まれている最も内側の `for`, `switch`, `select` 文の実行を直ちに終了し、そのループや文の次の処理に進みます。

```go title="無限ループと break の例"
package main

import (
	"fmt"
	"time"
)

func main() {
	count := 0

	fmt.Println("無限ループを開始します...(5回繰り返したら break します)")

	// 無限ループ
	for {
		count++
		fmt.Printf("ループ %d 回目\n", count)

		// 特定の条件 (count が 5 になったら) でループを抜ける
		if count >= 5 {
			fmt.Println("条件を満たしたので break します。")
			break // ループを終了
		}

		// 意図的に少し待機 (無限ループが速すぎると見えないため)
		time.Sleep(500 * time.Millisecond)
	}

	fmt.Println("ループが終了しました。")
}

/* 実行結果:
無限ループを開始します...(5回繰り返したら break します)
ループ 1 回目
ループ 2 回目
ループ 3 回目
ループ 4 回目
ループ 5 回目
条件を満たしたので break します。
ループが終了しました。
*/
```

**コード解説:**

*   `for { ... }`: 条件式がないため、無限ループを開始します。
*   `if count >= 5 { ... break }`: ループの各反復で `count` の値をチェックし、`5` 以上になったら `break` 文を実行します。
*   `break`: `break` が実行されると、`for` ループの処理が中断され、ループの直後にある `fmt.Println("ループが終了しました。")` の行に処理が移ります。

## 無限ループの用途

無限ループは、以下のような場面で使われることがあります。

*   **サーバープログラム:** 外部からのリクエストを待ち受け、処理し続けるサーバーなど。
*   **イベントループ:** ユーザーからの入力やイベントを待ち続け、対応する処理を行うGUIアプリケーションなど。
*   **バックグラウンドタスク:** 特定の条件が満たされるまで、またはプログラムが終了するまで、バックグラウンドで処理を実行し続ける場合。

ただし、無限ループを使う際は、必ずループから脱出する条件（`break` や `return`、あるいはプログラム自体の終了）がどこかに存在することを確認する必要があります。そうしないと、プログラムが応答しなくなったり、リソースを消費し続けたりする原因になります。