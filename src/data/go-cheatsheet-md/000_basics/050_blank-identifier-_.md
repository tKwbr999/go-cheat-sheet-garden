---
title: "ブランク識別子 `_`: 使わない値を無視する"
tags: ["basics", "変数", "ブランク識別子", "_"]
---

Go言語には、コードの品質を保つためのルールの一つとして、「宣言したのに使われていない変数があるとコンパイルエラーになる」という特徴があります。これは、意図しないバグを防ぐのに役立ちますが、時には関数の戻り値など、受け取る必要はあるけれど、その後の処理では使わない値も存在します。

そんな時に活躍するのが**ブランク識別子** `_` （アンダースコア）です。

## 未使用変数エラーと `_` の役割

```go title="未使用変数エラーの例 (コンパイルエラーになります)"
package main

import "fmt"

func main() {
	message := "hello"
	// この後、変数 message を使わない場合、コンパイル時にエラーが発生する
	// Error: message declared but not used
}
```

上記のコードは、変数 `message` を宣言しているにも関わらず、その後の処理で一切使用していないため、コンパイルエラーとなります。

ブランク識別子 `_` は、変数宣言の左辺に置くことで、「値は受け取るけれど、この変数は使いません」という意思表示をするための特別な記号です。`_` に代入された値は事実上捨てられ、未使用変数エラーを回避できます。

## `_` の主な使い方

### 1. 関数の複数の戻り値を一部無視する

Goの関数は複数の値を返すことができます。その中で、一部の戻り値だけが必要で、他は不要な場合に `_` がよく使われます。

```go title="関数の戻り値を `_` で無視する例"
package main

import (
	"fmt"
	"strconv" // 文字列と数値の変換機能を提供
)

func main() {
	// strconv.Atoi は文字列を整数に変換する関数
	// 戻り値は (変換後の整数, エラー情報) の2つ
	// 今回はエラー情報は使わないので `_` で受け取る
	numericValue, _ := strconv.Atoi("123")
	// もしエラーが発生しても、_ に代入されるためここではチェックできない

	fmt.Println("変換後の数値:", numericValue)

	// 逆に、エラー情報だけが必要な場合
	_, err := strconv.Atoi("abc") // "abc" は数値ではないのでエラーになるはず
	if err != nil {
		// エラーが発生した場合の処理
		fmt.Println("数値への変換に失敗しました:", err)
	}

	// fmt.Println も実は (書き込んだバイト数, エラー情報) を返す
	// 通常はこれらを無視することが多い
	_, _ = fmt.Println("この行の戻り値も無視")
}

/* 実行結果:
変換後の数値: 123
数値への変換に失敗しました: strconv.Atoi: parsing "abc": invalid syntax
この行の戻り値も無視
*/
```

**ポイント:**

*   `strconv.Atoi("123")` は `(123, nil)` を返します（`nil` はエラーがないことを示す）。`numericValue` に `123` が、`_` に `nil` が代入されます。
*   `strconv.Atoi("abc")` は `(0, エラー情報)` を返します。`_` に `0` が、`err` にエラー情報が代入されます。
*   このように、不要な戻り値を `_` で受けることで、未使用変数エラーを避けつつ、必要な値だけを扱うことができます。

### 2. `for range` ループでインデックスや値を無視する

`for range` ループでは、コレクション（配列、スライス、マップなど）の要素を順番に取り出す際に、インデックス（位置）と値の両方、またはどちらか一方だけを使いたい場合があります。不要な方を `_` で受け取ることができます。

```go title="for range で `_` を使う例"
package main

import "fmt"

func main() {
	fruits := []string{"apple", "banana", "cherry"}

	// 値だけが必要な場合 (インデックスを _ で無視)
	fmt.Println("果物リスト:")
	for _, fruit := range fruits {
		fmt.Println("-", fruit)
	}

	// インデックスだけが必要な場合 (値を _ で無視)
	fmt.Println("\nインデックス:")
	for i, _ := range fruits {
		fmt.Println(i)
	}

	// マップの場合 (キーだけ、または値だけを使う)
	colors := map[string]string{"red": "#FF0000", "green": "#00FF00", "blue": "#0000FF"}

	// キーだけが必要な場合
	fmt.Println("\n色 (キー):")
	for k, _ := range colors {
		fmt.Println(k)
	}

	// 値だけが必要な場合
	fmt.Println("\n色 (値):")
	for _, v := range colors {
		fmt.Println(v)
	}
}

/* 実行結果 (マップの順序は不定):
果物リスト:
- apple
- banana
- cherry

インデックス:
0
1
2

色 (キー):
red
green
blue

色 (値):
#FF0000
#00FF00
#0000FF
*/
```

### 3. `import` での副作用のための利用 (参考)

パッケージによっては、そのパッケージ自体を直接使うのではなく、インポートすること自体に意味がある場合があります（初期化処理 `init` 関数を実行させるなど）。このような場合、`import _ "パッケージパス"` のように書きます。

```go title="副作用のための import (参考)"
package main

import (
	"fmt"
	_ "image/png" // png 画像形式を扱えるようにするため。直接 png パッケージの関数は使わない
)

func main() {
	fmt.Println("PNG形式のデコーダーが登録されました (多分)")
	// image.Decode などを使う際に、事前に _ "image/png" をインポートしておく必要がある
}
```

ブランク識別子 `_` は、Goの「未使用変数は許さない」というルールの中で、柔軟にコードを書くための重要な仕組みです。