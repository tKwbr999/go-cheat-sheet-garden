## タイトル
title: コメント (Comments)

## タグ
tags: ["references", "code style", "comments", "documentation", "godoc"]

## コード
```go
package user // 例として user パッケージ

import "fmt"

// User はシステム内のユーザーを表す構造体です。
// Name と Age フィールドを持ちます。
type User struct {
	Name string
	Age  int
}

// NewUser は新しい User インスタンスを作成して返します。
// name が空の場合はエラーを返します。
func NewUser(name string, age int) (*User, error) {
	if name == "" {
		return nil, fmt.Errorf("ユーザー名は空にできません")
	}
	// 実装コメント: 年齢チェックはここでは行わない (将来追加するかも)
	return &User{Name: name, Age: age}, nil
}

// String は User の文字列表現を返します (fmt.Stringer を満たす)。
func (u *User) String() string {
	if u == nil {
		return "<nil>"
	}
	return fmt.Sprintf("%s (%d歳)", u.Name, u.Age)
}
```

## 解説
```text
Goのコードにおけるコメントは、コードの意図を伝え、可読性を高めるために重要です。Goでは主に2種類のコメントが使われます。

## ドキュメンテーションコメント (Documentation Comments)

*   **目的:** パッケージ、型、関数、メソッド、定数、変数など、**エクスポートされる（公開される）識別子**の役割や使い方を説明するために使われます。
*   **形式:** コメント対象の識別子の**直前**に、空行を挟まずに `//` で始まるコメント行を記述します。
*   **書き出し:** コメントの最初の文は、**コメント対象の識別子名で始まる**完全な文（主語＋述語）にするのが強い慣習です。これにより `godoc` が生成するドキュメントが読みやすくなります。
    *   例: `// User はシステム内のユーザーを表します。`
    *   例: `// CalculateTotal はアイテムの合計金額を計算して返します。`
*   **内容:** 何をするのか (What)、なぜそうするのか (Why)、どのように使うのか (How) を簡潔に説明します。自明なことを繰り返すコメントは避けます。
*   **パッケージコメント:** パッケージ全体の説明は、`package` 宣言の直前に記述します (`// Package mypkg は ...`)。 (`070_packages/020_package-documentation.md` 参照)
*   **`godoc`:** ドキュメンテーションコメントは `go doc` コマンドや `pkg.go.dev` によって自動的に抽出・整形され、APIドキュメントとして利用されます。（上記「コード」セクション参照）

## 実装コメント (Implementation Comments)

*   **目的:** コードブロックや特定の行について、その**実装の詳細**、**複雑なロジックの意図**、**注意点**、**将来的な改善点 (TODO)** などを説明するために使われます。
*   **形式:** `//` (行コメント) または `/* ... */` (ブロックコメント) を使います。通常は `//` が好まれます。
*   **場所:** 説明が必要なコードの近くに記述します。
*   **内容:** なぜそのように実装したのか (Why) を説明することが重要です。コードが何をしているか (What) をそのまま説明するだけのコメントは、コード自体を読めばわかるため、冗長になることがあります。

```go
func complexCalculation(input int) int {
	// ステップ1: 入力値を検証 (負の値は許可しない)
	if input < 0 {
		// TODO: エラーハンドリングをより丁寧にする (v1.2)
		return 0
	}

	result := input * 2 // 基本的な計算

	// ステップ2: 特定の条件下でボーナスを加算
	// この条件はビジネスロジック XYZ に基づく
	if input > 100 && input%7 == 0 {
		bonus := calculateBonus(input) // 別の関数でボーナス計算
		result += bonus
	}

	/*
	   複数行にわたるコメントが必要な場合や、
	   一時的にコードを無効化したい場合にブロックコメントを使うこともある。
	   fmt.Println("デバッグ出力:", result)
	*/

	return result
}

func calculateBonus(val int) int {
	// (複雑なボーナス計算ロジック)
	return val / 10
}
```

## コメントの原則

*   **コメントはコードを補完するもの:** コード自体が読みやすく、自己説明的であることが理想です。コメントは、コードだけでは伝わらない意図や背景、理由を説明するために使います。
*   **コメントを最新に保つ:** コードを変更したら、関連するコメントも必ず更新します。古いコメントは誤解を招き、コードの理解を妨げます。
*   **自明なことは書かない:** コードを見ればすぐにわかるようなコメントは不要です。
    ```go
    // i をインクリメントする (悪いコメント)
    i++
    ```
*   **良いコメントは「なぜ」を説明する:**
    ```go
    // タイムアウトを避けるため、バッファサイズを増やす
    bufferSize = 8192
    ```

適切なコメントは、コードの可読性、保守性、そしてチームでの共同作業を円滑にするために不可欠です。特に公開する API については、丁寧なドキュメンテーションコメントを心がけましょう。